<!DOCTYPE html>
<html lang="th" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="dark light" />
  <meta name="theme-color" content="#0ff" media="(prefers-color-scheme: dark)" />
  <meta name="theme-color" content="#0b0f1a" media="(prefers-color-scheme: light)" />
  <title>MEA‚ÄëSPU | ‡∏û‡∏•‡∏¥‡∏Å‡πÇ‡∏â‡∏°‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏î‡πâ‡∏ß‡∏¢ AI ‚Äî ‡∏ã‡πà‡∏≠‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏±‡∏á ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡∏¥</title>

  <style>
    /* ========== Design Tokens ========== */
    :root{
      --bg1:#0b0f1a; --bg2:#151d2b; --acc:#00e0ff; --acc2:#ff3df0;
      --ok:#26d07c; --bad:#ff5e6c; --warn:#ffd166; --txt:#eaf6ff; --muted:#9fb3c8;
      --ring:#6ee7ff; --surface:rgba(255,255,255,.06); --border:rgba(255,255,255,.12);
      --radius:20px; --radius-lg:24px; --gap:14px; --shadow:0 10px 40px rgba(0,0,0,.45);
    }
    @media (prefers-color-scheme: light){
      :root{ --txt:#0d1b2a; --muted:#4c6175; --surface:rgba(0,0,0,.04); --border:rgba(0,0,0,.12); --ring:#0aa9c2 }
      body{ background: linear-gradient(135deg,#f7fafc,#edf2f7) }
    }

    /* Reduce motion & transparency for accessibility */
    @media (prefers-reduced-motion: reduce){
      *{animation:none!important; transition:none!important; scroll-behavior:auto!important}
    }
    @media (prefers-reduced-transparency: reduce){
      .card{ background: #1b2433; }
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--txt);
      font-family:"Sarabun", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans Thai", "Sukhumvit Set", sans-serif;
      background: radial-gradient(1200px 800px at 70% -10%, #1a2550 0%, #121826 40%, #0a0d16 100%), linear-gradient(135deg,var(--bg1),var(--bg2));
      min-height:100svh; display:flex; align-items:center; justify-content:center; overflow-x:hidden;
    }

    /* Skip link */
    .skip{position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden}
    .skip:focus{left:12px; top:12px; width:auto; height:auto; padding:.6rem .8rem; background:#000; color:#fff; border-radius:12px; outline:2px solid var(--ring)}

    main.app{width:min(100%, 960px); padding:clamp(14px,3vw,24px)}

    .card{
      background: var(--surface); backdrop-filter: blur(14px);
      border:1px solid rgba(255,255,255,0.1); border-radius:var(--radius);
      padding:clamp(16px,3vw,28px); box-shadow:var(--shadow), inset 0 0 0 1px rgba(255,255,255,.05);
    }

    h1{margin:0 0 10px; line-height:1.15; font-size:clamp(24px,6vw,44px); letter-spacing:.3px;
      background:linear-gradient(90deg,var(--acc),var(--acc2)); -webkit-background-clip:text; background-clip:text; color:transparent;
      text-shadow:0 0 18px rgba(0,224,255,.35);
    }
    .sub{color:var(--muted); font-size:clamp(13px,3.5vw,18px)}
    .badge{display:inline-flex; gap:10px; align-items:center; background:linear-gradient(135deg,rgba(0,224,255,.18),rgba(255,61,240,.15));
      border:1px solid rgba(0,224,255,.35); padding:8px 14px; border-radius:999px; font-weight:700; font-size:clamp(12px,3.5vw,16px); margin:.5rem 0 1rem}
    .row{display:grid; gap:var(--gap)}
    .pill{padding:.35rem .7rem; border-radius:999px; background:rgba(255,255,255,.08); border:1px solid var(--border); display:inline-flex; gap:8px; align-items:center}
    .tools{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}

    /* Buttons */
    .btn{
      appearance:none; border:1px solid rgba(255,255,255,.18);
      background:linear-gradient(135deg,rgba(255,255,255,.08),rgba(255,255,255,.02));
      color:var(--txt); padding:12px 16px; border-radius:14px; font-weight:800; font-size:clamp(14px,4vw,18px);
      box-shadow:0 6px 18px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.06); cursor:pointer;
      line-height:1; min-height:44px;
    }
    .btn[disabled]{opacity:.6; cursor:not-allowed}
    .btn.primary{border-color:rgba(0,224,255,.6); background:linear-gradient(135deg,rgba(0,224,255,.25),rgba(255,61,240,.2))}
    .btn.ghost{background:transparent}
    .btn:focus-visible{outline:3px solid var(--ring); outline-offset:2px}

    /* HUD */
    .hud{display:grid; grid-template-columns:1fr auto; gap:12px; align-items:center; margin:.6rem 0 1rem; font-size:clamp(14px,4vw,18px)}
    .score{font-weight:800; font-size:clamp(18px,6vw,28px)} .qno{font-weight:800}
    .timer-wrap{height:14px; background:rgba(255,255,255,.08); border-radius:999px; overflow:hidden; border:1px solid var(--border); grid-column:1/-1}
    .timer-bar{height:100%; width:100%; background:linear-gradient(90deg,var(--ok),#6ee7ff,var(--acc2)); transition:width .16s linear}

    /* Question */
    .qtext{font-size:clamp(18px,5vw,26px); line-height:1.45; font-weight:900; letter-spacing:.2px}
    .choices{display:grid; gap:10px; margin-top:10px}
    .choice{
      display:flex; gap:10px; align-items:flex-start; width:100%;
      background:rgba(255,255,255,.06); border:1px solid var(--border);
      border-radius:16px; padding:14px 14px; text-align:left;
      font-size:clamp(15px,4.5vw,20px); font-weight:800; line-height:1.35; cursor:pointer;
      transition:transform .06s ease,border-color .2s, background .2s; color:#fff;
    }
    .choice:active{transform:scale(.99)}
    .choice .letter{flex:0 0 auto; width:36px; height:36px; border-radius:10px; display:grid; place-items:center; font-weight:900;
      background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.16); color:#fff}
    .choice.correct{border-color:rgba(38,208,124,.9); background:rgba(38,208,124,.15)}
    .choice.wrong{border-color:rgba(255,94,108,.9); background:rgba(255,94,108,.15)}
    .choice:focus-visible{outline:3px solid var(--ring); outline-offset:2px}

    .explain{margin-top:12px; padding:12px; border-radius:14px; border:1px dashed rgba(255,255,255,.25); background:rgba(255,255,255,.06); font-size:clamp(14px,4vw,18px)}

    .center{display:grid; place-items:center; text-align:center} .big{font-size:clamp(22px,8vw,46px); font-weight:900}
    .title{font-size:clamp(16px,4.5vw,20px); color:var(--muted)}
    .footnote{color:var(--muted); font-size:clamp(12px,3.5vw,14px); margin-top:8px}
    .hidden{display:none}
    .leader{margin-top:10px; border-top:1px dashed rgba(255,255,255,.2); padding-top:10px}
    .gold{color:#ffd166} .flex{display:flex; gap:10px; align-items:center; flex-wrap:wrap}

    canvas#fx{position:fixed; inset:0; pointer-events:none}
    select,option{font-weight:700}
    small.tag{font-size:.8em; opacity:.8}
    hr{border:0; border-top:1px dashed rgba(255,255,255,.2); margin:10px 0}
    .tagBtn{margin-left:6px}

    /* Floating Next button w/ safe-area */
    .footerNext{
      position: fixed; left: 0; right: 0; bottom: 12px; z-index: 10;
      display: none; justify-content: center;
      pointer-events: none; padding-bottom: max(0px, env(safe-area-inset-bottom));
    }
    .footerNext.show{ display:flex; pointer-events:auto }
    .footerNext .btn{ box-shadow:0 10px 30px rgba(0,0,0,.45); }

    /* Table */
    table{width:100%; border-collapse:collapse}
    thead th{position:sticky; top:0; background:rgba(255,255,255,.08); backdrop-filter:blur(8px)}
    td,th{padding:.5rem .6rem; border-bottom:1px dashed var(--border); text-align:center}
    td:first-child, th:first-child{width:2.5ch}

    /* Utility */
    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
  </style>
</head>
<body>
  <a href="#screen-quiz" class="skip">‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
  <canvas id="fx" aria-hidden="true"></canvas>
  <main class="app" role="main">

    <!-- HOME -->
    <section class="card" id="screen-home" aria-labelledby="home-title">
      <div class="badge" role="text">üöÄ ‡∏û‡∏•‡∏¥‡∏Å‡πÇ‡∏â‡∏°‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏î‡πâ‡∏ß‡∏¢ AI ‚Äî ‡∏ã‡πà‡∏≠‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏±‡∏á ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡∏¥ (MEA‚ÄëSPU)</div>
      <h1 id="home-title">AI Quiz Master: ‡∏à‡∏±‡∏î‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‚Äú‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏´‡∏°‡πâ‡∏≠‡πÅ‡∏õ‡∏•‡∏á‚Äù</h1>
      <p class="sub">‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢ <b>‡∏ú‡∏®.‡∏î‡∏£.‡∏†‡∏£‡∏ä‡∏±‡∏¢ ‡∏à‡∏π‡∏≠‡∏ô‡∏∏‡∏ß‡∏±‡∏í‡∏ô‡∏Å‡∏∏‡∏•</b> ‚Ä¢ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö <b>‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ä‡∏ß‡∏ô‡∏Ñ‡∏¥‡∏î</b> (POE) ‚Ä¢ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏ä‡πà‡∏≤‡∏á/‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏ô‡∏Ñ‡∏£‡∏´‡∏•‡∏ß‡∏á</p>
      <div class="row" style="margin-top:12px">
        <div class="pill" aria-label="‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠"><span aria-hidden="true">‚è±Ô∏è</span> 45 ‡∏ß‡∏¥/‡∏Ç‡πâ‡∏≠</div>
        <div class="pill" aria-label="‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô"><span aria-hidden>üèÅ</span> ‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡πá‡∏ß ‚áí ‡πÉ‡∏Å‡∏•‡πâ <b>1,000</b> ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏•‡∏î‡∏•‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤)</div>
        <div class="pill" aria-label="‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô"><span aria-hidden>üéß</span> ‡∏î‡∏ô‡∏ï‡∏£‡∏µ‡πÄ‡∏£‡πà‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</div>
        <label class="pill" for="mute"><input type="checkbox" id="mute" checked/> üîá ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á (‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î)</label>
      </div>
      <hr/>
      <div class="flex" role="group" aria-label="‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô">
        <div class="pill">üéöÔ∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏•‡πÄ‡∏ß‡∏•:
          <label class="sr-only" for="level">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å</label>
          <select id="level" aria-describedby="lvlHelp">
            <option value="Easy">Easy</option>
            <option value="Medium" selected>Medium</option>
            <option value="Hard">Hard</option>
            <option value="Mix">Mix (‡∏™‡∏∏‡πà‡∏°‡∏ó‡∏∏‡∏Å‡πÄ‡∏•‡πÄ‡∏ß‡∏•)</option>
          </select>
          <small id="lvlHelp" class="sr-only">‡πÉ‡∏ä‡πâ‡∏•‡∏π‡∏Å‡∏®‡∏£‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö</small>
        </div>
        <label class="pill" for="haptic"><input type="checkbox" id="haptic" checked/> üì≥ Haptic</label>
      </div>
      <div class="tools">
        <button class="btn primary" id="btn-start" type="button">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏•‡∏¢!</button>
        <button class="btn" id="btn-how" type="button">‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô</button>
      </div>
      <div class="leader" aria-live="polite">
        <div class="title">üèÜ ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ö‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ</div>
        ‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î: <b id="best">0</b> ‚Ä¢ ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <b id="plays">0</b>
      </div>
      <p class="footnote">* ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏¢‡∏∂‡∏î‡∏á‡∏≤‡∏ô‡∏†‡∏≤‡∏Ñ‡∏™‡∏ô‡∏≤‡∏° MEA/IEC/IEEE (‡πÄ‡∏ä‡∏¥‡∏á‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à)</p>
    </section>

    <!-- HOW -->
    <section class="card hidden" id="screen-how" aria-labelledby="how-title">
      <h1 id="how-title">‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô & ‡∏´‡∏•‡∏±‡∏Å‡∏Ñ‡∏¥‡∏î</h1>
      <p class="qtext">‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÑ‡∏ß‡πÉ‡∏ô <b>45 ‡∏ß‡∏¥</b> ‡∏¢‡∏¥‡πà‡∏á‡πÄ‡∏£‡πá‡∏ß‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏¢‡∏¥‡πà‡∏á‡πÄ‡∏¢‡∏≠‡∏∞ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÉ‡∏Å‡∏•‡πâ 1,000) ‡∏ú‡∏¥‡∏î/‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏î‡πâ 0 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
      <div class="explain">
        <div><b>‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ä‡∏ß‡∏ô‡∏Ñ‡∏¥‡∏î</b> ‡∏à‡∏∞‡∏ä‡∏ß‡∏ô‡∏ñ‡∏≤‡∏° 2 ‡∏Ç‡∏±‡πâ‡∏ô: ‚Äú‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á?‚Äù ‡πÅ‡∏•‡∏∞ ‚Äú‡∏≠‡∏∞‡πÑ‡∏£‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô/‡∏≠‡∏≤‡∏£‡πå‡∏Å‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ?‚Äù</div>
        <ul>
          <li><b>IPO</b>: Input ‚Üí Process ‚Üí Output</li>
          <li><b>POE</b>: Predict ‚Üí Observe ‚Üí Explain</li>
        </ul>
      </div>
      <div class="tools">
        <button class="btn" id="btn-back" type="button">‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö</button>
        <button class="btn primary" id="btn-start2" type="button">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏¥‡∏ã</button>
      </div>
    </section>

    <!-- QUIZ -->
    <section class="card hidden" id="screen-quiz" aria-labelledby="quiz-title">
      <h1 id="quiz-title" class="sr-only">‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏¥‡∏ã</h1>
      <div class="hud">
        <div class="flex" role="group" aria-label="‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞">
          <span class="pill" aria-label="‡∏Ñ‡∏≠‡∏£‡πå‡∏™">üìö MEA‚ÄëSPU</span>
          <span class="pill qno" id="qno" aria-live="polite">‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 1/10</span>
          <span class="pill">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <b id="score" aria-live="polite">0</b></span>
          <span class="pill"><small class="tag" id="lvlTag">Medium</small></span>
        </div>
        <div class="flex">
          <label class="pill" for="mute2"><input type="checkbox" id="mute2" checked/> üîá ‡πÄ‡∏™‡∏µ‡∏¢‡∏á</label>
        </div>
        <div class="timer-wrap" aria-hidden="true"><div id="bar" class="timer-bar"></div></div>
      </div>
      <div id="qtext" class="qtext" role="heading" aria-level="2">...</div>
      <div class="choices" id="choices" role="radiogroup" aria-label="‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö"></div>
      <div class="tools" role="group" aria-label="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡∏ï‡∏≠‡∏ö">
        <button class="btn" id="btn-hint1" type="button">‡∏Ç‡∏≠ Hint 1</button>
        <button class="btn" id="btn-hint2" type="button">‡∏Ç‡∏≠ Hint 2</button>
        <button class="btn ghost" id="btn-skip" type="button">‡∏Ç‡πâ‡∏≤‡∏° (0 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)</button>
        <button class="btn" id="btn-think" type="button">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ä‡∏ß‡∏ô‡∏Ñ‡∏¥‡∏î</button>
        <button class="btn" id="btn-think-sol" type="button" title="‡∏î‡∏π‡πÄ‡∏â‡∏•‡∏¢‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ä‡∏ß‡∏ô‡∏Ñ‡∏¥‡∏î">‡∏î‡∏π‡πÄ‡∏â‡∏•‡∏¢‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ä‡∏ß‡∏ô‡∏Ñ‡∏¥‡∏î</button>
      </div>
      <div class="explain hidden" id="explain" aria-live="polite"></div>

      <!-- Floating Next -->
      <div class="footerNext" id="footerNext">
        <button class="btn primary" id="btn-next-fixed" type="button">‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ ‚ûú</button>
      </div>
    </section>

    <!-- RESULT -->
    <section class="card hidden" id="screen-result" aria-labelledby="result-title">
      <h1 id="result-title">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• üéâ</h1>
      <div class="big" id="finalScore" aria-live="polite">0</div>
      <div class="sub" id="summary"></div>
      <div id="badge" class="center" style="margin:12px 0" aria-hidden="true"></div>
      <div class="tools center">
        <button class="btn primary" id="btn-retry" type="button">‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
        <button class="btn" id="btn-home" type="button">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
        <button class="btn" id="btn-review" type="button">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠</button>
      </div>
      <div class="leader">
        <div class="title">üìä ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</div>
        <div id="table"></div>
      </div>
    </section>

    <!-- REVIEW -->
    <section class="card hidden" id="screen-review" aria-labelledby="review-title">
      <h1 id="review-title">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• (‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å)</h1>
      <div id="reviewList"></div>
      <div class="tools">
        <button class="btn" id="btn-home2" type="button">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
      </div>
    </section>

  </main>

  <script>
  /* ========= Question Bank (‡∏Ñ‡∏±‡∏î‡πÄ‡∏î‡∏¥‡∏°) ========= */
  const BANK = { /* ... ‡πÉ‡∏ä‡πâ BANK ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå ‡πÄ‡∏î‡πÇ‡∏°‡πà‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å window.__BANK ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ ... */ };
  // ‡∏´‡∏≤‡∏Å‡∏ù‡∏±‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß ‡πÜ ‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î BANK ‡∏ï‡∏±‡∏ß‡πÄ‡∏ï‡πá‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÅ‡∏ó‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ö‡∏ô
  
  /* ========= Config ========= */
  const GAME_LEN = 10;        // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≠‡∏£‡∏≠‡∏ö
  const T_LIMIT  = 45_000;    // 45 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠

  /* ========= Utilities ========= */
  const $ = (s, r=document) => r.querySelector(s);
  const $$ = (s, r=document) => [...r.querySelectorAll(s)];
  const fmt = n => Number(n||0).toLocaleString('th-TH');
  const clamp = (n, a, b) => Math.min(b, Math.max(a, n));
  const shuffle = a => { for(let i=a.length-1;i>0;i--){ const j=(Math.random()*(i+1))|0; [a[i],a[j]]=[a[j],a[i]] } return a };
  const prefersReduced = matchMedia('(prefers-reduced-motion: reduce)').matches;

  /* ========= Accessibility: keyboard shortcuts ========= */
  // A/B/C/D or 1/2/3/4 to choose, Enter for next, Esc to Home
  const Key = { A:65,B:66,C:67,D:68, Digit1:49, Digit2:50, Digit3:51, Digit4:52, Enter:13, Escape:27 };

  /* ========= Audio (kept from original, wrapped safe) ========= */
  const AudioKit=(()=>{
    const Ctx = window.AudioContext||window.webkitAudioContext; if(!Ctx) return {startBG(){},stopBG(){},setMute(){},setUrgency(){},blip(){}};
    const ctx=new Ctx();
    let master=ctx.createGain(); master.gain.value=.0; master.connect(ctx.destination);
    let bgGain=ctx.createGain(); bgGain.gain.value=.22; bgGain.connect(master);
    let percGain=ctx.createGain(); percGain.gain.value=.18; percGain.connect(master);
    let bgPlaying=false, loopTimer=null, step=0, tempo=110;
    function resume(){ if(ctx.state==='suspended') ctx.resume(); }
    function note(freq, dur=0.15, gainNode=bgGain, type='square'){
      const o=ctx.createOscillator(), g=ctx.createGain();
      o.type=type; o.frequency.value=freq;
      g.gain.setValueAtTime(0.0008, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.25, ctx.currentTime+0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+dur);
      o.connect(g).connect(gainNode); o.start(); o.stop(ctx.currentTime+dur);
    }
    function click(){ const o=ctx.createOscillator(), g=ctx.createGain(); o.type='triangle'; o.frequency.value=900; g.gain.setValueAtTime(0.0008, ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.35, ctx.currentTime+0.003); g.gain.exponentialRampToValueAtTime(0.00001, ctx.currentTime+0.08); o.connect(g).connect(percGain); o.start(); o.stop(ctx.currentTime+0.09); }
    function loop(){ if(!bgPlaying) return; const beatMs=60000/tempo; const base=220; const scale=[0,4,7,12,14,16]; const n=base*Math.pow(2,(scale[step%scale.length])/12); note(n,.12,bgGain, step%8<4? 'square':'triangle'); if(step%2===0) click(); step++; loopTimer=setTimeout(loop, beatMs/2); }
    function startBG(){ if(bgPlaying) return; resume(); bgPlaying=true; step=0; loop(); }
    function stopBG(){ bgPlaying=false; clearTimeout(loopTimer); }
    function setMute(m){ master.gain.value = m? 0 : .6; }
    function setUrgency(r){ tempo = 110 + (1 - r) * 70; percGain.gain.value = .12 + (1 - r) * .18; }
    function blip(ok=true){ resume(); const o=ctx.createOscillator(), g=ctx.createGain(); o.type= ok? 'sine':'square'; o.frequency.value= ok? 880:220; g.gain.setValueAtTime(.001, ctx.currentTime); g.gain.exponentialRampToValueAtTime(.35, ctx.currentTime+.01); g.gain.exponentialRampToValueAtTime(.0001, ctx.currentTime+.25); o.connect(g).connect(master); o.start(); o.stop(ctx.currentTime+.3); }
    return {startBG,stopBG,setMute,setUrgency,blip};
  })();

  /* ========= Confetti ========= */
  const FX=(()=>{
    const c=$('#fx'), ctx=c.getContext('2d');
    function resize(){ c.width=innerWidth; c.height=innerHeight; }
    addEventListener('resize', resize, {passive:true}); resize();
    let parts=[];
    function boom(x=innerWidth/2,y=innerHeight/3,n=60){ for(let i=0;i<n;i++) parts.push({x,y,r:Math.random()*3+2,vx:(Math.random()-0.5)*6,vy:(Math.random()-1.4)*8,a:1}) }
    function paint(){ ctx.clearRect(0,0,c.width,c.height); for(const p of parts){ p.x+=p.vx; p.y+=p.vy; p.vy+=0.15; p.a-=0.01; } parts=parts.filter(p=>p.a>0); for(const p of parts){ ctx.globalAlpha=Math.max(0,p.a); ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fillStyle=`hsl(${(p.x+p.y)%360} 90% 60%)`; ctx.fill(); } requestAnimationFrame(paint); }
    paint();
    return {boom};
  })();

  /* ========= State ========= */
  let deck=[], idx=0, score=0, running=false, rafId=null, tStart=0, userAnswers=[], order=[];

  function show(sel){ ['#screen-home','#screen-how','#screen-quiz','#screen-result','#screen-review'].forEach(s=>$(s).classList.add('hidden')); $(sel).classList.remove('hidden'); }

  function buildDeck(level){ const src = level==='Mix'? [...window.__BANK?.Easy||[],...window.__BANK?.Medium||[],...window.__BANK?.Hard||[]] : (window.__BANK?.[level]||window.__BANK?.Medium||[]); return shuffle(src.slice()).slice(0, Math.min(GAME_LEN, src.length)); }

  /* ========= Timer w/ rAF ========= */
  function startTimer(){ tStart=performance.now(); cancelAnimationFrame(rafId); tick(); }
  function tick(){ const t=performance.now()-tStart; let left=Math.max(0, T_LIMIT - t); const ratio=left/T_LIMIT; $('#bar').style.width=(ratio*100)+"%"; $('#bar').style.background = ratio<.25? `linear-gradient(90deg,var(--bad),#ff99a5)` : ratio<.55? `linear-gradient(90deg,var(--warn),#ffe69a)` : `linear-gradient(90deg,var(--ok),#6ee7ff)`; AudioKit.setUrgency(ratio); if(running){ if(left<=0) timeUp(); else rafId=requestAnimationFrame(tick); } }

  /* ========= Flow ========= */
  function startGame(){
    const lv = $('#level').value;
    deck = buildDeck(lv);
    idx=0; score=0; userAnswers=[];
    $('#lvlTag').textContent = lv; $('#score').textContent = '0';
    show('#screen-quiz');
    const muted = $('#mute').checked; AudioKit.setMute(muted); if(!muted) AudioKit.startBG();
    nextQuestion();
  }

  function nextQuestion(){
    running=false; cancelAnimationFrame(rafId);
    const ex=$('#explain'); ex.classList.add('hidden'); ex.innerHTML=''; $('#footerNext').classList.remove('show');
    const q = deck[idx]; if(!q){ return endGame(); }
    $('#qno').textContent = `‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${idx+1}/${deck.length}`;
    $('#qtext').textContent = q.q;

    order = shuffle([0,1,2,3]);
    const box=$('#choices'); box.innerHTML='';
    order.forEach((origChoiceIdx, i)=>{
      const b=document.createElement('button'); b.className='choice'; b.type='button'; b.setAttribute('role','radio'); b.setAttribute('aria-checked','false'); b.dataset.choiceIndex=i; b.innerHTML=`<span class="letter">${'ABCD'[i]}</span> <span>${q.choices[origChoiceIdx]}</span>`;
      b.addEventListener('click', ()=>pick(i));
      b.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); pick(i); } });
      box.appendChild(b);
    });

    running=true; startTimer(); AudioKit.setUrgency(1);
    // autofocus first choice for keyboard users
    setTimeout(()=>{ const first=$('#choices .choice'); first && first.focus({preventScroll:true}); }, 0);
  }

  function markChoices(correctShuffledIndex, userShuffledIndex){
    const ch=$$('#choices .choice');
    ch.forEach((c,ii)=>{ c.disabled=true; c.setAttribute('aria-checked', ii===userShuffledIndex? 'true':'false'); if(ii===correctShuffledIndex) c.classList.add('correct'); if(userShuffledIndex!=null && ii===userShuffledIndex && ii!==correctShuffledIndex) c.classList.add('wrong'); });
  }

  function pick(shuffledIndex){ if(!running) return; running=false; cancelAnimationFrame(rafId);
    const q=deck[idx]; const selectedOrig = order[shuffledIndex];
    const correctShuffledIndex = order.indexOf(q.correct);
    markChoices(correctShuffledIndex, shuffledIndex);

    const elapsed=Math.min(T_LIMIT, performance.now()-tStart), remain=T_LIMIT - elapsed;
    const ok = (selectedOrig===q.correct);
    const got = ok ? Math.max(0, Math.round(1000*(remain/T_LIMIT))) : 0;
    score+=got; $('#score').textContent=fmt(score);

    userAnswers.push({i:selectedOrig, got, correct:q.correct, q:q.q, choices:q.choices, reasons:q.reasons, why:q.why, takeaway:q.takeaway, thinkQ:q.thinkQ, thinkA:q.thinkA, order:order.slice()});
    showExplain(ok, got);
    if(navigator.vibrate && $('#haptic').checked){ navigator.vibrate(ok? 30: [60,20,60]); }
    AudioKit.blip(ok);
    if(ok && got>700) FX.boom();
  }

  function timeUp(){ running=false; cancelAnimationFrame(rafId);
    const q=deck[idx]; const correctShuffledIndex = order.indexOf(q.correct);
    markChoices(correctShuffledIndex, null);
    userAnswers.push({i:null, got:0, correct:q.correct, q:q.q, choices:q.choices, reasons:q.reasons, why:q.why, takeaway:q.takeaway, thinkQ:q.thinkQ, thinkA:q.thinkA, order:order.slice()});
    showExplain(false,0,true);
    AudioKit.blip(false);
  }

  function showExplain(correct, got, timeout=false){
    const q=deck[idx]; const el=$('#explain');
    const head = correct? `‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! +${fmt(got)} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô` : (timeout? '‚åõ ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤!':'‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà');
    const list = order.map((origIdx, i)=>{ const isRight=(origIdx===q.correct); const mark=isRight? '‚úÖ ‡∏ñ‡∏π‡∏Å':'‚ùå ‡∏ú‡∏¥‡∏î'; const choiceText=q.choices[origIdx]; const reason=(q.reasons && q.reasons[origIdx]) ? q.reasons[origIdx] : (isRight? '‡∏ñ‡∏π‡∏Å: ‡∏ï‡∏£‡∏á‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠':'‡∏ú‡∏¥‡∏î: ‡πÑ‡∏°‡πà‡πÅ‡∏Å‡πâ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏/‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á'); return `<li><b>${'ABCD'[i]}.</b> ${choiceText} ‚Äî <b>${mark}</b> ¬∑ <span>${reason}</span></li>`; }).join('');

    el.innerHTML = `
      <div><b>${head}</b></div>
      <div class="sub"><b>‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ä‡∏ß‡∏ô‡∏Ñ‡∏¥‡∏î:</b> ${q.thinkQ || '‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á? ‡πÅ‡∏•‡∏∞‡∏≠‡∏∞‡πÑ‡∏£‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ?'}</div>
      <div class="tools" style="margin-top:8px"><button class="btn tagBtn" id="btn-see-think" type="button">‡∏î‡∏π‡πÄ‡∏â‡∏•‡∏¢‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ä‡∏ß‡∏ô‡∏Ñ‡∏¥‡∏î</button></div>
      <div style="margin-top:8px"><b>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</b><ul>${list}</ul></div>
      <div style="margin-top:6px"><b>‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:</b> ${q.why}</div>
      <div><b>Key Takeaway:</b> ${q.takeaway}</div>
      <div class="sub" style="margin-top:8px">‡∏Å‡∏î <b>‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ</b> ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏ï‡πà‡∏≠</div>
    `;
    el.classList.remove('hidden');

    // Show floating next
    const footer = $('#footerNext'); footer.classList.add('show');
    const goNext = ()=>{ footer.classList.remove('show'); idx++; if(idx<deck.length) nextQuestion(); else endGame(); };
    $('#btn-next-fixed').onclick = goNext;

    // Think solution
    $('#btn-see-think').onclick=()=>{ const sol = q.thinkA || '‡∏à‡∏±‡∏î‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ï‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô'; const tag = document.createElement('div'); tag.innerHTML = `<div class="sub"><b>‡πÄ‡∏â‡∏•‡∏¢‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ä‡∏ß‡∏ô‡∏Ñ‡∏¥‡∏î:</b> ${sol}</div>`; el.appendChild(tag); };

    el.scrollIntoView({behavior: prefersReduced? 'auto':'smooth', block:'nearest'});
  }

  function endGame(){
    show('#screen-result');
    $('#finalScore').textContent=fmt(score);
    const best = Number(localStorage.getItem('mea_best')||0);
    const plays = Number(localStorage.getItem('mea_plays')||0)+1;
    localStorage.setItem('mea_plays', String(plays));
    if(score>best) localStorage.setItem('mea_best', String(score));
    $('#plays').textContent=fmt(plays); $('#best').textContent=fmt(Math.max(best,score));
    $('#summary').innerHTML = score>=8000? '‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î! ‡∏™‡∏≤‡∏¢‡∏†‡∏≤‡∏Ñ‡∏™‡∏ô‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á üë∑‚Äç‚ôÄÔ∏è‚ö°' : score>=5000? '‡∏î‡∏µ‡∏°‡∏≤‡∏Å! ‡∏à‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏¢‡∏≠‡∏∞‡πÅ‡∏•‡πâ‡∏ß üí™' : '‡πÇ‡∏≠‡πÄ‡∏Ñ‡πÄ‡∏•‡∏¢! ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ä‡∏ß‡∏ô‡∏Ñ‡∏¥‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÅ‡∏•‡πâ‡∏ß‡∏¢‡∏¥‡∏á‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà üöÄ';

    const stars = clamp(Math.floor(score/2000),1,5);
    $('#badge').innerHTML = `
    <svg width="240" height="240" viewBox="0 0 240 240" role="img" aria-label="‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ${fmt(score)}">
      <defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#ffd166"/><stop offset="1" stop-color="#ffe9a3"/></linearGradient></defs>
      <circle cx="120" cy="120" r="105" fill="url(#g)" stroke="#f4c430" stroke-width="8"/>
      <text x="120" y="86" text-anchor="middle" font-size="18" font-weight="800" fill="#7a5300">MEA‚ÄëSPU</text>
      <text x="120" y="108" text-anchor="middle" font-size="14" font-weight="700" fill="#7a5300">‡∏ã‡πà‡∏≠‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏±‡∏á</text>
      ${Array.from({length:stars}).map((_,i)=>`<polygon transform="translate(${60+i*24},140) scale(1.25)" points="10,1 12,7 18,7 13,11 15,17 10,13 5,17 7,11 2,7 8,7" fill="#7a5300"/>`).join('')}
      <text x="120" y="192" text-anchor="middle" font-size="16" font-weight="900" fill="#7a5300">${fmt(score)} pts</text>
    </svg>`;
    if(score>=6000) FX.boom(innerWidth/2, innerHeight/2, 90);
    AudioKit.stopBG();

    const rows = userAnswers.map((r,i)=>{ const your = r.i==null? '‚Äî': 'ABCD'[r.order.indexOf(r.i)]; const ans = 'ABCD'[r.order.indexOf(r.correct)]; const ok = r.i===r.correct; return `<tr><td>${i+1}</td><td style="text-align:left">${r.q}</td><td>${your}</td><td>${ans}</td><td>${ok? '‚úÖ':'‚ùå'}</td><td>${fmt(r.got)}</td></tr>`; }).join('');
    $('#table').innerHTML = `<div style="overflow:auto; max-height:40svh"><table><thead><tr><th>#</th><th style="text-align:left">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</th><th>‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≠‡∏ö</th><th>‡πÄ‡∏â‡∏•‡∏¢</th><th>‡∏ú‡∏•</th><th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th></tr></thead><tbody>${rows}</tbody></table></div>`;
  }

  function makeReview(){
    const html = userAnswers.map((r,i)=>{ const list = r.order.map((origIdx, k)=>{ const isRight=(origIdx===r.correct); const mark=isRight? '‚úÖ ‡∏ñ‡∏π‡∏Å':'‚ùå ‡∏ú‡∏¥‡∏î'; const reason=(r.reasons && r.reasons[origIdx]) ? r.reasons[origIdx] : (isRight? '‡∏ñ‡∏π‡∏Å':'‡∏ú‡∏¥‡∏î'); return `<li><b>${'ABCD'[k]}.</b> ${r.choices[origIdx]} ‚Äî <b>${mark}</b> ¬∑ ${reason}</li>`; }).join(''); return `
      <div class="explain">
        <div><b>‡∏Ç‡πâ‡∏≠ ${i+1}.</b> ${r.q}</div>
        <div><b>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</b><ul>${list}</ul></div>
        <div>‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: <b>${r.i==null? '‚Äî':'ABCD'[r.order.indexOf(r.i)]}</b> ‚Ä¢ ‡πÄ‡∏â‡∏•‡∏¢: <b>${'ABCD'[r.order.indexOf(r.correct)]}</b></div>
        <div><b>‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ä‡∏ß‡∏ô‡∏Ñ‡∏¥‡∏î:</b> ${r.thinkQ || '-'}</div>
        <div><b>‡πÄ‡∏â‡∏•‡∏¢‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ä‡∏ß‡∏ô‡∏Ñ‡∏¥‡∏î:</b> ${r.thinkA || '-'}</div>
        <div><b>‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:</b> ${r.why}</div>
        <div><b>Key Takeaway:</b> ${r.takeaway}</div>
      </div>`; }).join('');
    $('#reviewList').innerHTML = html || `<div class="sub">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏•‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞</div>`;
  }

  /* ========= Bindings ========= */
  $('#btn-start').onclick=()=>startGame();
  $('#btn-start2').onclick=()=>startGame();
  $('#btn-how').onclick=()=>{show('#screen-how')};
  $('#btn-back').onclick=()=>{show('#screen-home')};
  $('#btn-retry').onclick=()=>startGame();
  $('#btn-home').onclick=()=>{show('#screen-home')};
  $('#btn-home2').onclick=()=>{show('#screen-home')};
  $('#btn-review').onclick=()=>{show('#screen-review'); makeReview()};
  $('#btn-skip').onclick=()=>timeUp();
  $('#btn-hint1').onclick=()=>sayHint(0);
  $('#btn-hint2').onclick=()=>sayHint(1);
  $('#btn-think').onclick=()=>{ const q=deck[idx]; const el=$('#explain'); const msg=`<div class="sub"><b>‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ä‡∏ß‡∏ô‡∏Ñ‡∏¥‡∏î:</b> ${q?.thinkQ || '‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á? ‡πÅ‡∏•‡∏∞‡∏≠‡∏∞‡πÑ‡∏£‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ?'}</div>`; if(el.classList.contains('hidden')){ el.classList.remove('hidden'); el.innerHTML=msg; } else { el.innerHTML += msg; } };
  $('#btn-think-sol').onclick=()=>{ const q=deck[idx]; const el=$('#explain'); const ans=`<div class="sub"><b>‡πÄ‡∏â‡∏•‡∏¢‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ä‡∏ß‡∏ô‡∏Ñ‡∏¥‡∏î:</b> ${q?.thinkA || '‡∏à‡∏±‡∏î‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ï‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô'}</div>`; if(el.classList.contains('hidden')){ el.classList.remove('hidden'); el.innerHTML=ans; } else { el.innerHTML += ans; } };

  function sayHint(n){ const q=deck[idx]; const el=$('#explain'); const msg = q?.hints?.[n] || '‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏™‡∏°‡∏≠'; if(el.classList.contains('hidden')){ el.classList.remove('hidden'); el.innerHTML=`<div class="sub"><b>Hint:</b> ${msg}</div>`; } else { el.innerHTML += `<div>${msg}</div>`; } }

  // sync mute toggles & persist settings
  $('#mute').onchange=e=>{ localStorage.setItem('mea_mute', e.target.checked? '1':'0'); AudioKit.setMute(e.target.checked); if(!e.target.checked) AudioKit.startBG(); else AudioKit.stopBG(); $('#mute2').checked=e.target.checked; };
  $('#mute2').onchange=e=>{ $('#mute').checked=e.target.checked; $('#mute').dispatchEvent(new Event('change', {bubbles:false})); };
  $('#level').onchange=e=>{ localStorage.setItem('mea_level', e.target.value); };
  $('#haptic').onchange=e=>{ localStorage.setItem('mea_haptic', e.target.checked? '1':'0'); };

  // Keyboard shortcuts
  addEventListener('keydown', (e)=>{
    if($('#screen-quiz').classList.contains('hidden')) return;
    const map = { [Key.A]:0,[Key.Digit1]:0,[Key.B]:1,[Key.Digit2]:1,[Key.C]:2,[Key.Digit3]:2,[Key.D]:3,[Key.Digit4]:3 };
    if(map[e.keyCode]!=null){ e.preventDefault(); pick(map[e.keyCode]); return; }
    if(e.keyCode===Key.Enter && !$('#screen-quiz').classList.contains('hidden') && $('#footerNext').classList.contains('show')){ e.preventDefault(); $('#btn-next-fixed').click(); }
    if(e.keyCode===Key.Escape){ e.preventDefault(); show('#screen-home'); }
  });

  /* ========= Boot ========= */
  (function init(){
    // Import BANK if present globally (keep compatibility with your original page)
    if(window.__BANK){ Object.assign(BANK, window.__BANK); }

    const best = Number(localStorage.getItem('mea_best')||0);
    const plays = Number(localStorage.getItem('mea_plays')||0);
    $('#best').textContent=fmt(best); $('#plays').textContent=fmt(plays);

    // Restore settings
    const savedMute = localStorage.getItem('mea_mute'); if(savedMute!=null){ $('#mute').checked = savedMute==='1'; }
    const savedLevel = localStorage.getItem('mea_level'); if(savedLevel){ $('#level').value = savedLevel; }
    const savedHaptic = localStorage.getItem('mea_haptic'); if(savedHaptic!=null){ $('#haptic').checked = savedHaptic==='1'; }

    show('#screen-home');
    document.body.addEventListener('click', ()=>{ try{AudioKit.setMute($('#mute').checked);}catch{} }, {once:true});
  })();
  </script>
</body>
</html>
